<!DOCTYPE html>
<html>
<head>
  <title>Color Experiment</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>

<style>
	#box{
		width: 600x;
		height: 100vh;
	}
	
	.form{
		width: 300px;
		background-color: #fff;
		padding: 15px;
		box-shadow: 2px 2px 5px #333;
	}
	
	.play-button{
		position: absolute;
		top: 50%;
		left: 50%;
		visibility: visible;
	}
	
	.play-button i{
		font-size: 5rem !important;
	}
	
	.counter{
		margin: 0;
		position: absolute;
		top: 50%;
		left: 50%;
		-ms-transform: translate(-50%, -50%);
		transform: translate(-50%, -50%);
		font-size: 5rem !important;
		
	
	}
	
	.remaining-time{
		font-size: 3rem !important;
		visibility: hidden;
		margin: 0;
		position: absolute;
		top: 50%;
		left: 50%;
		-ms-transform: translate(-50%, -50%);
		transform: translate(-50%, -50%);
	}
	
	.phoneStart{
		width: 100%;
		visibility: hidden;
	}
	
	/* On screens that are 900px or less, set the background color to blue */
	@media screen and (max-width: 992px) {
	  .phoneStart{
			width: 100%;
			visibility: visible;
		}
		
	  .play-button{
			margin: 0;
			position: absolute;
			top: 50%;
			left: 50%;
			-ms-transform: translate(-50%, -50%);
			transform: translate(-50%, -50%);
			visibility: hidden;
		}
		
	  .remaining-time{
		margin: 0;
		position: absolute;
		top: 50%;
		left: 50%;
		-ms-transform: translate(-50%, -50%);
		transform: translate(-50%, -50%);
		font-size: 2rem !important;
		visibility: hidden;
		
		
	
		}
	}
	
	/* On screens that are 520px or less, set the background color to blue */
	@media screen and (max-width: 520px) {

	  .remaining-time{
		margin: 0;
		position: absolute;
		top: 50%;
		left: 50%;
		-ms-transform: translate(-50%, -50%);
		transform: translate(-50%, -50%);
		font-size: 1.5rem !important;
		visibility: hidden;
		
		
	
		}
	}
	
	


</style>
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


<body >

<div class="container-fluid" >
	

		
</div>

<div class="container-fluid" id="box" ondblclick="onEscapeFullscreen">

	<div class="col-sm-12" >
	  
	  
	   <div class="btn-group">
		  <button id="settingsButton" type="button" class="btn btn-primary" data-toggle="collapse" data-target="#demo"><i class="fa fa-cogs"></i></button>
		 <!-- <button type="button" class="btn btn-primary" onclick="onPressAction()" ><i class="fa fa-play" aria-hidden="true"></i></button>-->
		</div> 

		<div id="demo" class="collapse show">
			<div class="form">
				<form action="/action_page.php">
					<label>Időtartam</label>
					<div class="row">
					<!--	<div class="col">
						  <input id="fromTime" placeholder="hrs:mins" type="time" class="form-control" placeholder="Enter email" name="email">
						</div>
						<div class="col">
						  <input id="toTime" type="time" class="form-control" placeholder="Enter password" name="pswd">
						</div> -->
						
						<div class="col" >
							<input id="hour" placeholder="óra" type="number" class="form-control" name="hours" />
						</div>
						<div class="col" >
							<input id="minute" placeholder="perc" type="number" class="form-control" name="minutes" />
						</div>
					</div>
					<label>Színek</label>
					<div id="formGroup" class="form-group">
					 
					  <input name="color" type="color" id="color0" class="form-control" value="#ff0000">
					  <input name="color" type="color" id="color1" class="form-control" value="#0000ff">
						
					</div>
					
					 <div class="btn-group">
					  <button type="button" class="btn btn-primary" onclick="addNewColor()" ><i class="fas fa-plus"></i></button>
					  <button type="button" class="btn btn-primary" onclick="removeNewColor()" ><i class="fas fa-minus"></i></button>

					</div> 
					
				</form>
				<br />
				  <button type="button" class="btn btn-primary phoneStart" data-toggle="collapse" data-target="#demo" onclick="onShowTimer()" >
					<i class="fa fa-play" aria-hidden="true"></i>
				  </button>
			</div>
		</div>
		
		
		
	</div>


		  <h1 id="counter" class="counter">5</h1>
		  <button id="playButton" type="button" class="btn btn-primary play-button" data-toggle="collapse" data-target="#demo" onclick="onShowTimer()" >
			<i class="fa fa-play" aria-hidden="true"></i>
		  </button>
		  <h1 id="remainingTime" class="remaining-time"><span id="remainTime">00:00:00</span><span id="totalTime"> / 00:00:00</span></h1>
	
</div>


<script>

	$(document).ready(function(){
		document.getElementById("box").addEventListener("dblclick", onEscapeFullscreen);
		document.getElementById("box").addEventListener("click", onShowTime);
		
		$("#counter").fadeOut();
	});

	

// linear interpolation between two values a and b
    // u controls amount of a/b and is in range [0.0,1.0]
    lerp = function(a,b,u) {
        return (1-u) * a + u * b;
    };
	
	var colorList = 0;
	
	var oStatus = true;
	
	var nDuration;
	var nCurrentTime = 0;
	
	onDrawFullTime= function(){
		var nFullDuration = nDuration;
		
		var endHour, endMinutes, endSeconds;
		var currHour, currMinutes, currSeconds;
		
		if(nFullDuration > 0 ){
			
			endHour = (nFullDuration/(3600*1000));
			endMinutes;
			endSeconds; 
			
			if(endHour > 0){
				
				endMinutes = (Number(endHour)-Math.trunc(endHour))*60;
				endHour = Math.trunc(Number((nFullDuration/(3600*1000))));
				endSeconds = (Number(endMinutes)-Math.trunc(endMinutes))*60;
				
				endMinutes = Math.trunc(endMinutes);
				endSeconds = Math.trunc(endSeconds);
			
				
				
			}
			else{
			
			}
			
			console.log(endHour.toString().length);
			console.log(endMinutes.toString().length);
			console.log(endSeconds.toString().length);
			
			endHour.toString().length 	 === 1 ? endHour 	= "0"+endHour 		: endHour;
			endMinutes.toString().length === 1 ? endMinutes	= "0"+endMinutes 	: endMinutes;
			endSeconds.toString().length === 1 ? endSeconds	= "0"+endSeconds 	: endSeconds;
			
			
			document.getElementById("totalTime").innerText = " / "+endHour+":"+endMinutes+":"+endSeconds;
		}
		
		console.log("hours",endHour);
		console.log("minutes",endMinutes);
		console.log("seconds",endSeconds);
	};
	
	reDrawRemainTime = function(nCurrTime){
	
		var milliseconds = parseInt((nCurrTime % 100)),
		seconds = Math.floor((nCurrTime / 100) % 60),
		minutes = Math.floor((nCurrTime / (100 * 60)) % 60),
		hours = Math.floor((nCurrTime / (100 * 60 * 60)) % 24);

		  hours = (hours < 10) ? "0" + hours : hours;
		  minutes = (minutes < 10) ? "0" + minutes : minutes;
		  seconds = (seconds < 10) ? "0" + seconds : seconds;

			
		document.getElementById("remainTime").innerText = ""+hours+":"+minutes+":"+seconds;
		
	
	};
    
    fade = function(element, property, start, end, duration, iteration, laststep) {
      var interval = 10;
      var steps = duration/interval;
      var step_u = 1.0/steps;
      var u = 0.0;
	  
	  nDuration = duration;
	  
      var theInterval = setInterval(function(){

		
		nCurrentTime++
		
		reDrawRemainTime(Math.trunc(nCurrentTime));
		
		
		if(oStatus === false){
		
			colorList = laststep;
			u = 1.0;
		}
		
        var r = parseInt(lerp(start.r, end.r, u));
        var g = parseInt(lerp(start.g, end.g, u));
        var b = parseInt(lerp(start.b, end.b, u));
		
        var colorname = 'rgb('+r+','+g+','+b+')';

		//Show button if the transition is over
		 if (u >= 1.0){ 
			
		}
		if(u >=1.0){
			clearInterval(theInterval) 
			console.log("fade iteration", iteration);
			console.log("last step", laststep);
			
			
			if(colorList != laststep){
				colorList++;
				onPressAction(colorList);
			}
			else{
				$("#playButton").fadeIn(1000);
				$("#settingsButton").fadeIn(1000);
				onCloseFullScreen();
				colorList = 0;
				nCurrentTime = 0;
				oStatus = true;
				nDuration = 0;
				document.getElementById("remainTime").innerText = "00:00:00";
			}
		
			
			
			//
		}
		
        el.style.setProperty(property, colorname);
        u += step_u;
      }, interval);
    };
    
    // in action
    el = document.getElementById('box'); // your element
    property = 'background-color';       // fading property
    //startColor = {r:255, g:  0, b:  0};  // red
    //endColor   = {r:  0, g:128, b:128};  // dark turquoise
	
    onOpenFullScreen = function(){
		var elem = document.documentElement;
		
		 if (elem.requestFullscreen) {
			elem.requestFullscreen();
		 } else if (elem.webkitRequestFullscreen) { /* Safari */
			elem.webkitRequestFullscreen();
		 } else if (elem.msRequestFullscreen) { /* IE11 */
			elem.msRequestFullscreen();
		 }
	}
	
	onCloseFullScreen = function(){
	 if (document.exitFullscreen) {
		document.exitFullscreen();
	  } else if (document.webkitExitFullscreen) { /* Safari */
		document.webkitExitFullscreen();
	  } else if (document.msExitFullscreen) { /* IE11 */
		document.msExitFullscreen();
	  }
	}
	
	addNewColor = function(){
	  var oColor = document.createElement("input");
	  
	  oColor.setAttribute("class", "form-control");
	  oColor.setAttribute("type", "color");
	  oColor.setAttribute("value", "#ff0000");
	  oColor.setAttribute("name", "color");
	  oColor.setAttribute("id", "color"+Number(document.getElementsByName("color").length));
	 
	  document.getElementById("formGroup").appendChild(oColor); 
	}
	
	removeNewColor = function(){
		var nLastId = Number(document.getElementsByName("color").length)-1;
		var oElement = document.getElementById("color"+nLastId);
		
		oElement.parentNode.removeChild(oElement);
		
	}
	
	onPressAction = function(fromColor,toColor){
		var d = document;
		var nDuration;
		
		var oStartColor, oEndColor;
		
		console.log("fromColor",colorList);
		
		
		

		//itt van felülírva a két szín
		var sStartColor = document.getElementById("color"+colorList).value;
		var sEndColor = document.getElementById("color"+(colorList+1)).value;
		
		var aStartColor = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(sStartColor);
		var aEndColor = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(sEndColor);
		
		oStartColor = 	{r:parseInt(aStartColor[1], 16), g:parseInt(aStartColor[2], 16), b:parseInt(aStartColor[3], 16)}; 
		oEndColor = 	{r:parseInt(aEndColor[1], 16), g:parseInt(aEndColor[2], 16), b:parseInt(aEndColor[3], 16)};
		
		var nHour = Number(document.getElementById("hour").value);
		var nMinute = Number(document.getElementById("minute").value);
		
		if(nHour != undefined && nHour != ""){
			nDuration = nHour + nMinute/60
		}
		else{
			nDuration = 0 + nMinute/60
		}
	
		
		
		var iterate = document.getElementsByName("color").length-1;
		var lastStep = document.getElementsByName("color").length-2;
		
		var nDurationInMs = nDuration*60*60*1000;

		console.log("Duration", lastStep);

		fade(el,'background-color',oStartColor,oEndColor,nDurationInMs/iterate,iterate,lastStep);
		
		$("#playButton").fadeOut(1000);
		$("#settingsButton").fadeOut(1000);
		
		
		
	};
	
	///this can be a timer
	onShowTimer = function(){
		onOpenFullScreen();
		$("#playButton").fadeOut(1000);
		$("#counter").fadeIn(100);
		
		console.log(document.getElementById("demo"));
		
		onCheckCollapsed();
		
		var x = 5;
		var intervalID = setInterval(function () {

		   // Your logic here
			document.getElementById("counter").textContent = x;

			 console.log("test",document.getElementById("counter").textContent);

		   if (--x === 0) {
		   
			   window.clearInterval(intervalID);
				$("#counter").fadeOut(500);
				
					onInitFade(1)
				
				
		   }
		}, 1000);
		
	
	},
	
	onSetTime = function(){
		var d = document;

		d.getElementById("fromTime").value = new Date().getHours().toString() + ":" + new Date().getMinutes().toString();
		d.getElementById("fromTime").disabled = true
		
		d.getElementById("toTime").value = ((new Date().getHours())+1).toString() + ":" + new Date().getMinutes().toString();
	
		console.log(d.getElementById("toTime"));
	};
	
	//https://www.apispreadsheets.com/upload
	onSendData = function(){
	
		var d = document;
	
		var oData ={
			starttime: d.getElementById("hour").value,
			endtime: d.getElementById("minute").value,
			duration: "",
			fromcolor: d.getElementById("color1").value,	
			tocolor: d.getElementById("color2").value
		
		}
	
		fetch("https://api.apispreadsheets.com/data/3689/", {
			method: "POST",
			body: JSON.stringify({"data": oData}),
		}).then(res =>{
			if (res.status === 201){
				// SUCCESS
			}
			else{
				// ERROR
			}
		})
	
	
	};
	
	$(document).ready(function(){
	 // onSetTime();
	  console.log("test");
	});
	
	
	onInitFade = function(nIterate){	  
		  var sEndColor,
		  aEndColor,
		  oEndColor,
	      property,
		  oStartColor;
		  var nIteration = nIterate;
		  var interval = 10;
		  var steps = 1000/interval;
		  var step_u = 1.0/steps;
		  var u = 0.0;
		  
		  
			sEndColor = document.getElementById("color0").value;
			aEndColor = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(sEndColor);
			oEndColor = 	{r:parseInt(aEndColor[1], 16), g:parseInt(aEndColor[2], 16), b:parseInt(aEndColor[3], 16)};
			property = "background-color";
			
			
			oStartColor = {r:255,g:255,b:255};
		  
		  
		  
		  var theInterval = setInterval(function(){
		  
			if (u >= 1.0){ 
				clearInterval(theInterval) 
			}
			
			
			var r = parseInt(lerp(oStartColor.r, oEndColor.r, u));
			var g = parseInt(lerp(oStartColor.g, oEndColor.g, u));
			var b = parseInt(lerp(oStartColor.b, oEndColor.b, u));
			
			var colorname = 'rgb('+r+','+g+','+b+')';

			//Show button if the transition is over
			if(u >1.0){
				onPressAction();
				
			}
			
			el.style.setProperty(property, colorname);
			u += step_u;
		  }, interval);
	};
	
	onEscapeFullscreen = function(){
		
		oStatus = false;
		
		if(document.fullscreen){
			onCloseFullScreen();
		}
		
	};
	
	onShowTime = function(){
		console.log("onShowTime");
		
		onDrawFullTime();	
		
		console.log(nDuration);
		
		if(nDuration > 0){
		
		document.getElementById("remainingTime").style.visibility = "visible";
		$("#remainingTime").fadeIn();
		
		setTimeout(function(){ $("#remainingTime").fadeOut(); }, 3000);
		
		}
		
		
		
	};
	
	onCheckCollapsed = function(){
		if($('#settingsButton').attr("aria-expanded")){
			$('#settingsButton').click()
		}
	}

</script>
</body>
</html>
